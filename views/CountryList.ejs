<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Country Checklist</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  </head>
  <body>
    <div id="Navbar" class="d-flex justify-content-center"></div>
    <div id="CountryListOps">
      Filter By:
      <select id="CountryListFilter">
        <option value="All">All</option>
        <option value="Visited">Visited</option>
        <option value="Unvisited">Unvisited</option>
      </select>
      Sort by:
      <select id="CountryListSort">
        <option value="Alphabetical">Alphabetical</option>
        <option value="Visited">Visited</option>
        <option value="Unvisited">Unvisited</option>
      </select>
    </div>
    <div>
      <ul id="CountryList">
      </ul>
    </div>
    

  </body>
  <script>
    var visited = <%-JSON.stringify(visited)%>;
    var abr2name = <%-JSON.stringify(abr2name)%>;

    $(document).ready(function(){
      $('#Navbar').load("header.html", function() {
        $('a[id*=\'homeButton\']').attr('class', 'nav-link');
        $('#listButton').attr('class', 'nav-link active');
        $('#mapButton').attr('class', 'nav-link');
      });

      for (let m in abr2name) {
        var $list = $('#CountryList');
        $list.append(`<li> ${abr2name[m]}: ${visited[m]} </li>`);
        sortList($list);        
      };
    });

    function sortList(list) {
      list.children().detach().sort(function(a, b) {
        return $(a).text().localeCompare($(b).text());
      }).appendTo(list);
    }

    function reverseList(list) {
      list.children().detach().reverse(function(a, b) {
        return $(a).text().localeCompare($(b).text());
      }).appendTo(list);
    }
    
    $('#CountryListFilter').on('change', function() {
      // this.value
      $('#CountryList').empty();
      if (this.value == 'All') {
        for (let m in visited) {
          var $list = $('#CountryList');
          $list.append(`<li> ${abr2name[m]}: ${visited[m]} </li>`);
          sortList($list);
        };
      }
      else if (this.value == 'Visited') {
        for (let m in visited) {
          if (visited[m]) {
            $('#CountryList').append(`<li> ${abr2name[m]}: ${visited[m]} </li>`);
          }          
        };
      }
      else {
        for (let m in visited) {
          if (!visited[m]) {
            var $list = $('#CountryList');
            $list.append(`<li> ${abr2name[m]}: ${visited[m]} </li>`);
            sortList($list);
          }          
        };
      }
    });

    $('#CountryListSort').on('change', function() {
      alert( this.value );
    });
  </script>
</html>